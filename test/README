
# ğŸ§ª Airplane Control System - Unit Tests

This directory contains comprehensive unit tests for the ESP32 Airplane Control System using the PlatformIO Unity testing framework.

## ğŸ¯ Test Suites

### ğŸ›©ï¸ **test_airplane** - Flight Control Tests
Tests the core `Airplane` class functionality:
- âš¡ Engine/throttle control (0-180)
- ğŸ¯ Rudder control with angle limits
- â¬†ï¸â¬‡ï¸ Elevator control 
- ğŸ›©ï¸ Aileron control (dual servo)
- ğŸ”§ Trim adjustment and limits
- ğŸ”„ Reset functions
- ğŸ›¡ï¸ Safety defaults and validation

### ğŸ“¡ **test_lora** - Communication Protocol Tests  
Tests the LoRa communication system:
- ğŸ“¦ Packet parsing and validation
- ğŸ” XOR checksum verification
- ğŸ“Š Data extraction from protocol fields
- âŒ Malformed packet rejection
- ğŸ›‘ Airbrake and trim reset commands
- ğŸ›ï¸ Extreme value handling

### ğŸ›¡ï¸ **test_safety** - Safety System Tests
Tests critical safety mechanisms:
- â±ï¸ Connection timeout detection (2 second limit)
- ğŸš¨ Emergency mode activation
- ğŸ”„ Safe state reset (all controls neutral)
- âœ… Input validation and boundary checking
- ğŸ“¡ Connection recovery procedures
- â° Timing edge cases

### ğŸ”— **test_main** - Integration Tests
Orchestrates all test suites and provides:
- ğŸ¯ Test runner coordination
- ğŸ“Š Comprehensive result reporting
- ğŸ”— Cross-module integration testing
- ğŸ’» Both native and ESP32 execution

## ğŸš€ Running Tests

### ğŸ“‹ **Prerequisites**
```bash
# Install PlatformIO Core
pip install platformio

# Or use PlatformIO IDE extension in VS Code
```

### ğŸ–¥ï¸ **Native Testing (PC)**
Run tests on your development machine for faster iteration:
```bash
# Run all tests on native platform
pio test -e native

# Run specific test suite
pio test -e native --filter test_airplane
pio test -e native --filter test_lora  
pio test -e native --filter test_safety
```

### ğŸ“± **Hardware Testing (ESP32)**
Run tests on actual ESP32 hardware:
```bash
# Run tests on ESP32 hardware
pio test -e test

# Upload and monitor test results
pio test -e test --monitor
```

### ğŸ¯ **Individual Test Execution**
```bash
# Run only airplane control tests
pio test --filter "*airplane*"

# Run only safety tests  
pio test --filter "*safety*"

# Run only communication tests
pio test --filter "*lora*"
```

## ğŸ“Š Test Output

Tests provide detailed output including:
- âœ… **Pass/Fail Status** for each test
- ğŸ“ˆ **Performance Metrics** 
- ğŸ” **Detailed Error Messages**
- ğŸ“Š **Coverage Statistics**
- ğŸ¯ **Test Summary Reports**

Example output:
```
ğŸ§ª Starting Airplane Unit Tests...
âœ… test_throttle_control - PASSED
âœ… test_aileron_control - PASSED  
âœ… test_safety_defaults - PASSED
ğŸ“Š 10/10 tests passed (100%)
ğŸš€ Ready for Takeoff!
```

## ğŸ—ï¸ Test Structure

Each test suite follows this structure:
```cpp
#include <unity.h>

void setUp(void) {
    // Reset state before each test
}

void tearDown(void) {
    // Clean up after each test  
}

void test_feature_name(void) {
    // Arrange - Set up test conditions
    // Act - Execute the functionality
    // Assert - Verify expected results
    TEST_ASSERT_EQUAL(expected, actual);
}

int main() {
    UNITY_BEGIN();
    RUN_TEST(test_feature_name);
    return UNITY_END();
}
```

## ğŸ”§ Adding New Tests

1. **Create test file** in appropriate directory:
   ```
   test/test_new_feature/test_new_feature.cpp
   ```

2. **Follow naming convention**:
   - `test_[module]_[feature]()`
   - Use descriptive names
   - Group related tests

3. **Include proper assertions**:
   ```cpp
   TEST_ASSERT_TRUE(condition);
   TEST_ASSERT_EQUAL(expected, actual);
   TEST_ASSERT_NOT_NULL(pointer);
   ```

4. **Test edge cases**:
   - Boundary conditions
   - Invalid inputs  
   - Error conditions
   - Resource limits

## ğŸ›¡ï¸ Safety Testing Guidelines

When testing safety-critical aviation systems:

- âœ… **Test all failure modes**
- âœ… **Verify timeout handling** 
- âœ… **Check emergency procedures**
- âœ… **Validate input boundaries**
- âœ… **Test connection recovery**
- âœ… **Verify safe defaults**

## ğŸ“ˆ Continuous Integration

Tests are designed to run in CI/CD pipelines:
```yaml
# Example GitHub Actions
- name: Run Unit Tests
  run: pio test -e native
  
- name: Run Hardware Tests  
  run: pio test -e test
```

## ğŸ¤ Contributing Tests

When contributing new tests:
1. ğŸ§ª **Write tests first** (TDD approach)
2. âœ… **Ensure 100% pass rate** 
3. ğŸ“ **Document test purpose**
4. ğŸ¯ **Cover edge cases**
5. ğŸš€ **Test on both native and hardware**

---

*For more information about PIO Unit Testing:*
*https://docs.platformio.org/page/plus/unit-testing.html*
